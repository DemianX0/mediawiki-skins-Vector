@import '../vector.variables.less';
@import 'mediawiki.mixins.less';
@import 'mediawiki.mixins.flex-align.less';
@import './layout.less';
@import 'legacy/Sidebar.less';

@margin-horizontal-sidebar-button-icon: 12px;
//@background-color-sidebar-toggle: #e8e8e8;
@background-color-sidebar-toggle: @background-color-secondary--modern;
@background-color-sidebar-toggle--active: @background-color-base;
@box-shadow-color-sidebar-toggle--active: #bbb;
//@box-shadow-color-sidebar-toggle--active: @background-color-frameless--hover;

#mw-sidebar-button {
	//width: @size-sidebar-button;
	//height: @size-sidebar-button;
	padding: ( @size-sidebar-button - @size-sidebar-button-icon ) / 2; // 0.75em -> 12px
	margin-left: -@margin-horizontal-sidebar-button-icon;
	margin-right: @margin-horizontal-sidebar-button-icon; // Accidentally the same.

	&:before {
		width: @size-sidebar-button-icon; // 1.25em -> 20px
		height: @size-sidebar-button-icon;
		line-height: @size-sidebar-button-icon;
		//height: 100%;
		// Center it horizontally.
		//margin: 0 @margin-horizontal-sidebar-button-icon;
		// Equals `#555`, closest to `#54595d` on background-color `#fff`.
		opacity: 0.67;
	}

	&:hover {
		background-color: @background-color-frameless--hover;

		&:before {
			opacity: 1;
		}
	}
}

.mw-sidebar-button {
	border: 1px solid transparent;
	border-radius: @border-radius-base;

	&.mw-ui-icon {
		// Override minimum dimensions set by .mw-ui-icon
		min-width: auto;
		min-height: auto;
		line-height: @line-height-nav;
	}

	&:focus {
		&:extend( .vector-menu--checkbox:focus + .vector-menu--button ); // Add the selector to the already existing rule.
	}
}

// Disable transitions on page load. No-JS users will unfortunately miss out. A similar pattern is
// used in Minerva's DropDownList. See enableCssAnimations() in skin.vector.js/index.js for context
// and additional details on how this class is added.
.vector-animations-ready {
	// Enable sidebar button transitions.
	.mw-sidebar-button {
		.transition(
			background-color @transition-duration-base,
			border-color @transition-duration-base,
			box-shadow @transition-duration-base;
		);
	}
}

.mw-ui-icon:before {
	display: inline-block;
	vertical-align: bottom;
	background-repeat: no-repeat;
	background-size: contain; // Support: IE9.
	background-position: center;
	content: '';
}

.mw-sidebar-toggles {

	// Horizontal centering.
	//.flex-display();
	//.justify-content( center ); // Support: IE11.
	// Relative to the outer width of the sidebar.
	padding-right: @padding-left-sidebar - @padding-right-sidebar;
	// Vertical space between toggle buttons and sidebar content.
	margin-bottom: 1em; // 16px
	margin-bottom: 0.5em; // 8px
	margin-left: 0.5em;

	.mw-sidebar-button {
		padding: 0.1em; // 1.6px
		padding: 0.2em; // 3.2px
		margin: 0 0.25em; // 4px
		background-color: @background-color-sidebar-toggle;
		border: @border-width-base @border-style-base @colorGray10;
		//box-shadow: 0 0 0.5em 0 @background-color-sidebar-toggle;
		//box-shadow: 0 0 0.1em 0.2em @background-color-sidebar-toggle;

		&:before {
			width: @size-sidebar-toggle-icon;
			height: @size-sidebar-toggle-icon;
			line-height: @size-sidebar-toggle-icon;
		}

		&.selected {
			background-color: @background-color-sidebar-toggle--active;
			box-shadow: 0 0 0 @border-width-base @color-base--active;
			//box-shadow: 0 0 0.3em 0.15em @box-shadow-color-sidebar-toggle--active;

			&:before {
				// Highlight .mw-ui-icon of active panel.
				opacity: 1;
			}
		}
	}

	.mw-ui-icon-listBullet,
	.mw-ui-icon-textFlow {
		.transform( scaleX( -1 ) );
	}
}

.mixin-sidebar-hider( @name, @css-selector-panel ) {
	@css-id-radio: ~'mw-sidebar-@{name}-radio';

	#@{css-id-radio}:not( :checked ) {
		~ @{css-selector-panel} {
			display: none;
		}
	}

	#@{css-id-radio}:checked {
		~ @{css-selector-sidebar-toggles-base} label[for=@{css-id-radio}] {
			&:extend( .mw-sidebar-toggles .mw-sidebar-button.selected all );
			// all -> inherit `&:before { opacity }` too.
		}
	}
}

.mixin-sidebar-hider( navigation, @css-selector-sidebar-navigation );
.mixin-sidebar-hider( toc, @css-selector-sidebar-toc );

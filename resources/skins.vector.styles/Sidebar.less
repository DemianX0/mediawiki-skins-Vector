@import '../variables.less';
@import 'mediawiki.mixins.less';
@import 'mediawiki.mixins.flex-align.less';
@import './layout.less';

//@background-color-sidebar-toggle: #e8e8e8;
//@background-color-sidebar-toggle: @background-color-secondary--modern;
@background-color-sidebar-toggle--active: @background-color-secondary--modern;
@background-color-sidebar-toggle--active: @colorShadow;
//@box-shadow-color-sidebar-toggle--active: @background-color-frameless--hover;

#mw-sidebar-button {
	@padding--px: ( @size-sidebar-button--px - @size-sidebar-button-icon--px ) / 2; // (44-20)/2=12px
	padding: unit( @padding--px / @font-size-header--px, em ); // 0.75em -> 12px
	// Line up the icon with the sidebar content:
	@margin-left--px: @padding-left-sidebar--px - @padding--px - @padding-horizontal-header--px + @margin-horizontal-portal--px; // 8-12-16+16 = -4px
	margin-left: unit( @margin-left--px / @font-size-header--px, em ); // -0.25em
	margin-right: unit( 6px / @font-size-header--px, em );

	&:before {
		@size: unit( @size-sidebar-button-icon--px / @font-size-header--px, em ); // 1.25em -> 20px
		width: @size;
		height: @size;
		line-height: @size;
		//height: 100%;
		// Center it horizontally.
		//margin: 0 @margin-horizontal-sidebar-button-icon;
		// Equals `#555`, closest to `#54595d` on background-color `#fff`.
		opacity: 0.67;
	}

	&:hover {
		background-color: @background-color-frameless--hover;

		&:before {
			opacity: 1;
		}
	}
}

.mw-sidebar-button {
	border: 1px solid transparent;
	border-radius: @border-radius-base;

	&.mw-ui-icon {
		// Override minimum dimensions set by .mw-ui-icon
		min-width: auto;
		min-height: auto;
		line-height: @line-height-nav;
	}

	&:focus {
		&:extend( .vector-menu--checkbox:focus + .vector-menu--button ); // Add the selector to the already existing rule.
	}
}

// Disable transitions on page load. No-JS users will unfortunately miss out. A similar pattern is
// used in Minerva's DropDownList. See enableCssAnimations() in skin.vector.js/index.js for context
// and additional details on how this class is added.
.vector-animations-ready {
	// Enable sidebar button transitions.
	.mw-sidebar-button {
		.transition(
			background-color @transition-duration-base,
			border-color @transition-duration-base,
			box-shadow @transition-duration-base;
		);
	}
}

.mw-ui-icon:before {
	display: inline-block;
	vertical-align: bottom;
	background-repeat: no-repeat;
	background-size: contain; // Support: IE9.
	background-position: center;
	content: '';
}

/* Panel */
.mw-sidebar {
	font-size: @font-size-sidebar;

	> * {
		margin: 1em 0; // Expects margin collapsing. Alternative: 0.5em + flex layout.

		&:first-child {
			margin-top: 0.5em;
		}

		> * {
			padding: 0 1rem;
		}
	}
}

.mw-sidebar-toggles {
	// Horizontal centering.
	.flex-display();
	.justify-content( center ); // Support: IE11.
	// Relative to the outer width of the sidebar.
	//padding-right: @padding-left-sidebar - @padding-right-sidebar;
	// Vertical space between toggle buttons and sidebar content.

	.mw-sidebar-button {
		padding: 0.2em; // 3.2px
		margin: 0 0.75em; // 12px
		//background-color: @background-color-sidebar-toggle;
		//border: @border-width-base @border-style-base @colorGray10;
		//box-shadow: 0 0 0.5em 0 @background-color-sidebar-toggle;
		//box-shadow: 0 0 0.1em 0.2em @background-color-sidebar-toggle;

		&:before {
			width: @size-sidebar-toggle-icon;
			height: @size-sidebar-toggle-icon;
			line-height: @size-sidebar-toggle-icon;
		}

		&.selected {
			background-color: @background-color-sidebar-toggle--active;
			//box-shadow: 0 0 0 @border-width-base @color-base--active;
			box-shadow: 0 0 0.3em 0.15em @background-color-sidebar-toggle--active;

			&:before {
				// Highlight .mw-ui-icon of active panel.
				opacity: 1;
			}
		}
	}

	.mw-ui-icon-listBullet,
	.mw-ui-icon-textFlow {
		.transform( scaleX( -1 ) );
	}
}

.mixin-sidebar-hider( @name, @css-selector-panel ) {
	@css-id-radio: ~'mw-sidebar-@{name}-radio';

	#@{css-id-radio}:not( :checked ) {
		~ @{css-selector-panel} {
			display: none;
		}
	}

	#@{css-id-radio}:checked {
		~ @{css-selector-sidebar-toggles-base} label[for=@{css-id-radio}] {
			&:extend( .mw-sidebar-toggles .mw-sidebar-button.selected all );
			// all -> inherit `&:before { opacity }` too.
		}
	}
}

.mixin-sidebar-hider( navigation, @css-selector-sidebar-navigation );
.mixin-sidebar-hider( toc, @css-selector-sidebar-toc );

// Increase the space between links on mobile to make it easier to touch.
@media ( min-resolution: 192dpi ), ( min-resolution: 2dppx ) {
	.vector-menu-portal .vector-menu--list li,
	.mw-sidebar .tocnumber,
	.mw-sidebar .toctext,
	.mw-sidebar ol li:before,
	.mw-sidebar ul li:before {
		padding-top: @padding-vertical-sidebar-item--touch;
		padding-bottom: @padding-vertical-sidebar-item--touch;
	}
}
